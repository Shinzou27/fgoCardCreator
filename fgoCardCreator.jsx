var matrix =   [["1", "Mash Kyrielight", "SR"],
            ["2", "Artoria Pendragon", "SSR"],
            ["3", "Artoria Pendragon (Alter)", "SR"],
            ["4", "Artoria Pendragon (Lily)", "SR"],
            ["5", "Nero Claudius", "SR"],
            ["6", "Siegfried", "SR"],
            ["7", "Gaius Julius Caesar", "R"],
            ["8", "Altera", "SSR"],
            ["9", "Gilles de Rais", "R"],
            ["10", "Chevalier d'Eon", "SR"],
            ["11", "EMIYA", "SR"],
            ["12", "Gilgamesh", "SSR"],
            ["13", "Robin Hood", "R"],
            ["14", "Atalanta", "SR"],
            ["15", "Euryale", "R"],
            ["16", "Arash", "C"],
            ["17", "Cú Chulainn", "R"],
            ["18", "Elizabeth Báthory", "SR"],
            ["19", "Musashibou Benkei", "UC"],
            ["20", "Cú Chulainn (Proto)", "R"],
            ["21", "Leonidas I", "UC"],
            ["22", "Romulus", "R"],
            ["23", "Medusa", "R"],
            ["24", "Georgios", "UC"],
            ["25", "Edward Teach", "UC"],
            ["26", "Boudica", "R"],
            ["27", "Ushiwakamaru", "R"],
            ["28", "Alexander", "R"],
            ["29", "Marie Antoinette", "SR"],
            ["30", "Martha", "SR"],
            ["31", "Medea", "R"],
            ["32", "Gilles de Rais", "R"],
            ["33", "Hans Christian Andersen", "UC"],
            ["34", "William Shakespeare", "UC"],
            ["35", "Mephistopheles", "R"],
            ["36", "Wolfgang A. Mozart", "C"],
            ["37", "Zhuge Liang", "SSR"],
            ["38", "Cú Chulainn (Caster)", "R"],
            ["39", "Sasaki Kojirou", "C"],
            ["40", "Cursed Arm Hassan", "UC"],
            ["41", "Stheno", "SR"],
            ["42", "Jing Ke", "R"],
            ["43", "Charles-Henri Sanson", "UC"],
            ["44", "Phantom of the Opera", "UC"],
            ["45", "Mata Hari", "C"],
            ["46", "Carmilla", "SR"],
            ["47", "Heracles", "SR"],
            ["48", "Lancelot", "SR"],
            ["49", "Lu Bu Fengxian", "R"],
            ["50", "Spartacus", "C"],
            ["51", "Sakata Kintoki", "SSR"],
            ["52", "Vlad III", "SSR"],
            ["53", "Asterios", "C"],
            ["54", "Caligula", "UC"],
            ["55", "Darius III", "R"],
            ["56", "Kiyohime", "R"],
            ["57", "Eric Bloodaxe", "UC"],
            ["58", "Tamamo Cat", "SR"],
            ["59", "Jeanne d'Arc", "SSR"],
            ["60", "Orion", "SSR"],
            ["61", "Liz (Halloween)", "SR"],
            ["62", "Tamamo no Mae", "SSR"],
            ["63", "David", "R"],
            ["64", "Hector", "R"],
            ["65", "Francis Drake", "SSR"],
            ["66", "Anne Bonny & M. Read", "SR"],
            ["67", "Medea (Lily)", "SR"],
            ["68", "Okita Souji", "SSR"],
            ["69", "Oda Nobunaga", "SR"],
            ["70", "Scáthach", "SSR"],
            ["71", "Diarmuid Ua Duibhne", "R"],
            ["72", "Fergus mac Róich", "R"],
            ["73", "Artoria (Santa Alter)", "SR"],
            ["74", "Nursery Rhyme", "SR"],
            ["75", "Jack the Ripper", "SSR"],
            ["76", "Mordred", "SSR"],
            ["77", "Nikola Tesla", "SSR"],
            ["78", "Artoria Pendragon (Alter)", "SR"],
            ["79", "Paracelsus", "R"],
            ["80", "Charles Babbage", "R"],
            ["81", "Henry Jekyll & Hyde", "R"],
            ["82", "Frankenstein", "SR"],
            ["84", "Arjuna", "SSR"],
            ["85", "Karna", "SSR"],
            ["86", "Mysterious Heroine X", "SSR"],
            ["87", "Fionn mac Cumhaill", "SR"],
            ["88", "Brynhildr", "SSR"],
            ["89", "Beowulf", "SR"],
            ["90", "Nero Claudius (Bride)", "SSR"],
            ["91", "Ryougi Shiki", "SSR"],
            ["92", "Ryougi Shiki", "SR"],
            ["93", "Amakusa Shirou", "SSR"],
            ["94", "Astolfo", "SR"],
            ["95", "Kid Gil", "R"],
            ["96", "Edmond Dantès", "SSR"],
            ["97", "Nightingale", "SSR"],
            ["98", "Cú Chulainn (Alter)", "SSR"],
            ["99", "Queen Medb", "SSR"],
            ["100", "Helena Blavatsky", "SR"],
            ["101", "Rama", "SR"],
            ["102", "Li Shuwen (Lancer)", "SR"],
            ["103", "Thomas Edison", "SR"],
            ["104", "Geronimo", "R"],
            ["105", "Billy the Kid", "R"],
            ["106", "Jeanne d'Arc (Alter)", "SSR"],
            ["107", "Angra Mainyu", "0"],
            ["108", "Iskandar", "SSR"],
            ["109", "EMIYA", "SR"],
            ["110", "Hassan of the H. Faces", "R"],
            ["111", "Irisviel (Holy Grail)", "SR"],
            ["112", "Shuten Douji", "SSR"],
            ["113", "Xuanzang Sanzang", "SSR"],
            ["114", "Minamoto no Raikou", "SSR"],
            ["115", "Sakata Kintoki (Rider)", "SR"],
            ["116", "Ibaraki Douji", "SR"],
            ["117", "Fuuma Kotarou", "R"],
            ["118", "Ozymandias", "SSR"],
            ["119", "Artoria Pendragon", "SSR"],
            ["120", "Nitocris", "SR"],
            ["121", "Lancelot", "SR"],
            ["122", "Tristan", "SR"],
            ["123", "Gawain", "SR"],
            ["124", "Hassan of the Serenity", "R"],
            ["125", "Tawara Touta", "R"],
            ["126", "Bedivere", "R"],
            ["127", "Leonardo Da Vinci", "SSR"],
            ["128", "Tamamo-no-Mae", "SSR"],
            ["129", "Artoria Pendragon", "SSR"],
            ["130", "Marie Antoinette", "SR"],
            ["131", "Anne Bonny & M. Read", "SR"],
            ["132", "Mordred", "SR"],
            ["133", "Scáthach", "SR"],
            ["134", "Kiyohime", "SR"],
            ["135", "Martha", "SR"],
            ["136", "Illyasviel von Einzbern", "SSR"],
            ["137", "Chloe von Einzbern", "SR"],
            ["138", "Liz (Brave)", "SR"],
            ["139", "Cleopatra", "SSR"],
            ["140", "Vlad III (EXTRA)", "SR"],
            ["141", "Jeanne (Alter Santa Lily)", "SR"],
            ["142", "Ishtar", "SSR"],
            ["143", "Enkidu", "SSR"],
            ["144", "Quetzalcoatl", "SSR"],
            ["145", "Gilgamesh (Caster)", "SR"],
            ["146", "Medusa (Lancer)", "SR"],
            ["147", "Gorgon", "SR"],
            ["148", "Jaguar Man", "R"],
            ["150", "Merlin", "SSR"],
            ["153", "Miyamoto Musashi", "SSR"],
            ["154", "King Hassan", "SSR"],
            ["155", "Myst. Heroine X (Alter)", "SSR"],
            ["156", "James Moriarty", "SSR"],
            ["157", "EMIYA (Alter)", "SR"],
            ["158", "Hessian Lobo", "SR"],
            ["159", "Yan Qing", "SR"],
            ["160", "Arthur Pendragon (Proto)", "SSR"],
            ["161", "Hijikata Toshizō", "SSR"],
            ["162", "Chacha", "SR"],
            ["163", "Meltlilith", "SSR"],
            ["164", "Passionlip", "SR"],
            ["165", "Suzuka Gozen", "SR"],
            ["166", "B B", "SR"],
            ["167", "Sesshōin Kiara", "SSR"],
            ["169", "Scheherazade", "SSR"],
            ["170", "Wu Zetian", "SR"],
            ["171", "Penthesilea", "SR"],
            ["172", "Christopher Columbus", "R"],
            ["173", "Sherlock Holmes", "SSR"],
            ["174", "Paul Bunyan", "C"],
            ["175", "Nero Claudius", "SSR"],
            ["176", "Frankenstein", "SR"],
            ["177", "Nitocris", "SR"],
            ["178", "Oda Nobunaga", "SR"],
            ["179", "Artoria Pendragon", "SSR"],
            ["180", "Helena Blavatsky", "SR"],
            ["181", "Minamoto-no-Raikou", "SR"],
            ["182", "Ishtar", "SR"],
            ["183", "Parvati", "SR"],
            ["184", "Tomoe Gozen", "SR"],
            ["185", "Mochizuki Chiyome", "SR"],
            ["186", "Houzouin Inshun", "R"],
            ["187", "Yagyu Munenori", "SR"],
            ["188", "Katou Danzou", "SR"],
            ["189", "Osakabehime", "SSR"],
            ["190", "Mecha Eli-chan", "SR"],
            ["191", "Mecha Eli-chan Mk.II", "SR"],
            ["192", "Circe", "SR"],
            ["193", "Nezha", "SR"],
            ["194", "Queen of Sheba", "SR"],
            ["195", "Abigail Williams", "SSR"],
            ["196", "Ereshkigal", "SSR"],
            ["197", "Altera the San(ta)", "SR"],
            ["198", "Katsushika Hokusai", "SSR"],
            ["199", "Semiramis", "SSR"],
            ["200", "Asagami Fujino", "SR"],
            ["201", "Anastasia", "SSR"],
            ["202", "Atalanta (Alter)", "SR"],
            ["203", "Avicebron", "R"],
            ["204", "Antonio Salieri", "R"],
            ["205", "Ivan the Terrible", "SSR"],
            ["206", "Achilles", "SSR"],
            ["207", "Chiron", "SR"],
            ["208", "Sieg", "SR"],
            ["209", "Okita Souji (Alter)", "SSR"],
            ["210", "Fábio Aranha", "R"],
            ["211", "Sakamoto Ryouma", "SR"],
            ["212", "Napoléon", "SSR"],
            ["213", "Sigurd", "SSR"],
            ["214", "Valkyrie", "SR"],
            ["215", "Scáthach-Skaði", "SSR"],
            ["216", "Jeanne d'Arc", "SSR"],
            ["217", "Ibaraki Dōji", "SR"],
            ["218", "Ushiwakamaru", "SR"],
            ["219", "Jeanne d'Arc (Alter)", "SR"],
            ["220", "B B (Summer)", "SSR"],
            ["221", "Queen Medb", "SR"],
            ["222", "Mysterious Heroine XX", "SR"],
            ["223", "Diarmuid Ua Duibhne", "SR"],
            ["224", "Sitonai", "SSR"],
            ["225", "Shuten Douji", "SR"],
            ["226", "Xiang Yu", "SSR"],
            ["227", "Lanling Wang", "SR"],
            ["228", "Qin Liangyu", "SR"],
            ["229", "Shi Huang Di", "SSR"],
            ["230", "Consort Yu", "SR"],
            ["231", "Red Hare", "R"],
            ["232", "Bradamante", "SSR"],
            ["233", "Quetzalcoatl (Samba)", "SR"],
            ["234", "Beni-enma", "SSR"],
            ["235", "Li Shuwen", "SSR"],
            ["236", "Miyu Edelfelt", "SR"],
            ["237", "Murasaki Shikibu", "SSR"],
            ["238", "Kingprotea", "SSR"],
            ["239", "Kama", "SSR"],
            ["241", "Sima Yi (Reines)", "SSR"],
            ["242", "Astraea", "SR"],
            ["243", "Gray", "SR"],
            ["244", "Jinako Carigiri", "SSR"],
            ["245", "Lakshmibai", "SR"],
            ["246", "William Tell", "R"],
            ["247", "Arjuna (Alter)", "SSR"],
            ["248", "Ashvatthaman", "SR"],
            ["249", "Asclepius", "R"],
            ["250", "Demon King Nobunaga", "SSR"],
            ["251", "Mori Nagayoshi", "R"],
            ["252", "Nagao Kagetora", "SR"],
            ["253", "Leonardo Da Vinci", "SSR"],
            ["254", "Jason", "C"],
            ["255", "Paris", "UC"],
            ["256", "Gareth", "UC"],
            ["257", "Bartholomew Roberts", "C"],
            ["258", "Chen Gong", "UC"],
            ["259", "Charlotte Corday", "C"],
            ["260", "Salome", "UC"],
            ["261", "Miyamoto Musashi", "SSR"],
            ["262", "Osakabehime", "SR"],
            ["263", "Carmilla", "SR"],
            ["264", "Katsushika Hokusai", "SR"],
            ["265", "Artoria Pendragon", "SSR"],
            ["266", "Mysterious Alter Ego Λ", "SR"],
            ["267", "Okita J Souji", "SR"],
            ["268", "Space Ishtar", "SSR"],
            ["269", "Calamity Jane", "SR"],
            ["270", "Astolfo", "SSR"],
            ["271", "Nightingale (Santa)", "SR"],
            ["272", "Super Orion", "SSR"],
            ["273", "Mandricardo", "R"],
            ["274", "Europa", "SSR"],
            ["275", "Yang Guifei", "SSR"],
            ["276", "Sei Shounagon", "SSR"],
            ["277", "Odysseus", "SSR"],
            ["278", "Dioscuri", "SSR"],
            ["279", "Caenis", "SR"],
            ["280", "Romulus-Quirinus", "SSR"],
            ["281", "Voyager", "SSR"],
            ["282", "Kijyo Koyou", "SR"],
            ["283", "Utsumi Erice", "SR"],
            ["284", "Artoria Caster", "SSR"],
            ["285", "Sesshōin Kiara", "SSR"],
            ["286", "Illyasviel von Einzbern", "SR"],
            ["287", "Brynhildr", "SR"],
            ["288", "Consort Yu", "SR"],
            ["289", "Abby (Summer)", "SSR"],
            ["290", "Tomoe Gozen", "SR"],
            ["291", "Murasaki Shikibu", "SR"],
            ["292", "Himiko", "SSR"],
            ["293", "Saitou Hajime", "SR"],
            ["294", "Oda Nobukatsu", "C"],
            ["295", "Van Gogh", "SSR"],
            ["296", "Nemo", "SSR"],
            ["297", "Ashiya Douman", "SSR"],
            ["298", "Watanabe-no-Tsuna", "SR"],
            ["299", "Ibuki Douji", "SSR"],
            ["300", "Vritra", "SSR"],
            ["301", "Karna (Santa)", "SR"],
            ["302", "Senji Muramasa", "SSR"],
            ["303", "Taira no Kagekiyo", "SSR"],
            ["304", "Kiichi Hougen", "SR"],
            ["305", "Amor (Caren)", "SSR"],
            ["306", "Galatea", "SSR"],
            ["307", "Miss Crane", "SSR"],
            ["308", "Mysterious Idol X (Alter)", "SR"],
            ["309", "Morgan", "SSR"],
            ["310", "Barghest", "SR"],
            ["311", "Baobhan Sith", "SR"],
            ["312", "Mélusine (Arts ST)", "SSR"],
            ["312", "Mélusine (Buster AoE)", "SSR"],
            ["313", "Percival", "SR"],
            ["314", "Koyanskaya of Light", "SSR"],
            ["315", "Habetrot", "SR"],
            ["316", "Oberon", "SSR"],
            ["317", "Okita Souji (Alter)", "SSR"],
            ["318", "Anastasia & Viy", "SR"],
            ["319", "Charlotte Corday", "SR"],
            ["320", "Leonardo Da Vinci", "SR"],
            ["321", "Kama", "SSR"],
            ["322", "Caenis", "SR"],
            ["323", "Sei Shounagon", "SR"],
            ["324", "Jacques de Molay", "SSR"],
            ["325", "Zenobia", "SR"],
            ["326", "Liz (Cinderella)", "SR"],
            ["327", "Izumo-no-Okuni", "SSR"],
            ["328", "Mysterious Ranmaru X", "SR"],
            ["329", "Sakamoto Ryouma", "SSR"],
            ["330", "Martha (Santa)", "SR"],
            ["331", "Tai Gong Wang", "SSR"],
            ["332", "Dobrynya Nikitich", "SR"],
            ["334", "Koyanskaya of Darkness", "SSR"],
            ["335", "Hephaestion", "SR"],
            ["337", "Trung Sisters", "SSR"],
            ["338", "Taisui Xingjun", "SR"],
            ["339", "Super Bunyan", "SSR"],
            ["340", "Daikokuten", "SR"],
            ["341", "Mary Anning", "C"],
            ["342", "Constantine XI", "SSR"],
            ["343", "Charlemagne", "SSR"],
            ["344", "Roland", "SR"],
            ["345", "Kriemhild", "SR"],
            ["346", "James Moriarty", "SSR"],
            ["347", "Don Quixote", "SR"],
            ["348", "Zhang Jue", "R"],
            ["349", "Kyokuten Bakin", "SSR"],
            ["350", "Minamoto no Tametomo", "SSR"],
            ["351", "Archetype: Earth", "SSR"],
            ["352", "Xu Fu", "R"],
            ["353", "Lady Avalon", "SSR"],
            ["354", "Gareth", "SR"],
            ["355", "Ibuki Douji", "SSR"],
            ["356", "Utsumi Erice", "SR"],
            ["357", "Scáthach-Skaði", "SSR"],
            ["358", "Wu Zetian", "SR"],
            ["359", "Thrúd", "SR"],
            ["360", "Hildr", "SR"],
            ["361", "Ortlinde", "SR"],
            ["362", "Sen no Rikyu", "SSR"],
            ["363", "Yamanami Keisuke", "SR"],
            ["364", "Iyo", "SR"],
            ["365", "Huyan Zhuo", "SSR"],
            ["366", "Huang Feihu", "SR"],
            ["367", "9 Tattoo Dragon Eliza", "SR"],
            ["368", "Britomart", "SSR"],
            ["369", "Grigori Rasputin", "SSR"],
            ["370", "Nitocris (Alter)", "SSR"],
            ["371", "Tezcatlipoca", "SSR"],
            ["372", "Tlaloc", "SR"],
            ["373", "Kukulcan", "SSR"]];
var matrixLines = matrix.length;
var doc = app.activeDocument;
doc.activeLayer = doc.layers.getByName("Starting Point");
var file = app.openDialog();
var grailedServants = createGrailedServantsArray();

var width = 614;
var height = 869;

if(file[0]){ 
    doc.layers.getByName("Servant FA").name = "Prev Servant FA";
    app.load(file[0]);
    for (i = 0; i < matrixLines; i++) {
        if (file[0].name == (matrix[i][0] + ".png")) {
            var servantName = matrix[i][1];
            var servantRarity = matrix[i][2];
            var servantID = matrix[i][0];
            break
        }
    }

    var backFile = app.activeDocument;
    backFile.resizeImage(width,height);
    backFile.selection.selectAll();
    backFile.selection.copy();
    backFile.close(SaveOptions.DONOTSAVECHANGES);
    doc.paste();

    var servantArt = doc.activeLayer;
    servantArt.translate(-317, 73);
    servantArt.name = "Servant FA";
    doc.layers.getByName("Prev Servant FA").remove();

    for (i = 0; i < 3; i++) {
        var thisSkillName = "Skill " + (i + 1);       
        var skillImg = app.openDialog();
        width = 164;
        height = 164;
        if (skillImg[0]) {
            doc.layers.getByName(thisSkillName).remove();
            app.load(skillImg[0]);
            backFile = app.activeDocument;
            backFile.resizeImage(width,height);
            backFile.selection.selectAll();
            backFile.selection.copy();
            backFile.close(SaveOptions.DONOTSAVECHANGES);
            doc = app.activeDocument;
            doc.paste();
            var skillImgDoc = doc.activeLayer;
            skillImgDoc.translate(120+360*i, 60);
            skillImgDoc.name = thisSkillName;
        }
    }

    var editable = doc.layerSets.getByName("Editable").artLayers;

    var colorBronze = new SolidColor();
    var rgbBronze = colorBronze.rgb;
    rgbBronze.red = 88;
    rgbBronze.green = 30;
    rgbBronze.blue = 30;

    var colorSilver = new SolidColor();
    var rgbSilver = colorSilver.rgb;
    rgbSilver.red = 138;
    rgbSilver.green = 138;
    rgbSilver.blue = 138;

    var colorGold = new SolidColor();
    var rgbGold = colorGold.rgb;
    rgbGold.red = 243;
    rgbGold.green = 243;
    rgbGold.blue = 32;  
    
    /*
    Hex:
    colorBronze = #581e1e
    colorSilver = #8a8a8a
    colorGold = #e7e018
    */

    for (k = 1; k <= 3; k++) {
        skill = prompt("Insert Skill " + k + " Level.");
        skillLayer = editable.getByName("SkillTXT " + k); 
        if (skill != null && skill != "") {
            alert(skill != null && skill != "")
            if (skill == '10' && skillLayer.textItem.contents != '10') {
            skillLayer.textItem.size = 150;
            skillLayer.translate(0, -11.23);
            }  
            else if (skill != '10' && skillLayer.textItem.contents == '10') {
                skillLayer.textItem.size = 189;
                skillLayer.translate(0, 11.23);
            }
            skillLayer.textItem.contents = skill;
        }
    }
    var svtStats = [
        {
            "color": colorBronze,
            "level": 'Level: 60',
            "np": 'NP5'
        },
        {
            "color": colorBronze,
            "level": 'Level: 65',
            "np": 'NP5'
        },
        {
            "color": colorSilver,
            "level": 'Level: 70',
            "np": 'NP5'
        },
        {
            "color": colorGold,
            "level": 'Level: 80',
            "np": 'NP1'
        },
        {
            "color": colorGold,
            "level": 'Level: 90',
            "np": 'NP1'
        },
        {
            "rarities": ["C", "UC", "R", "SR", "SSR"]
        }
    ]

    var rarityColor;
    var servantLevel;
    var npLevel;
    setAssets(servantRarity);
    editable.getByName("Rarity").textItem.color = rarityColor;
    editable.getByName("NP Level").textItem.contents = npLevel;
    editable.getByName("Servant Level").textItem.contents = servantLevel;
    editable.getByName("Servant Name").textItem.contents = servantName;
    editable.getByName("Rarity").textItem.contents = servantRarity;
    editable.getByName("ID").textItem.contents = servantID;
    if (documents.length > 0) {
        var fileName = servantID + "-" + servantName;
        saveJPEG(fileName);
    }
}

function saveJPEG(fileName) {
  var myFile = new File(doc.path + "/" + fileName + ".jpeg")
  var JPEGOptions = new ExportOptionsSaveForWeb()

  JPEGOptions.format = SaveDocumentType.JPEG;
  JPEGOptions.embedColorProfile = false;
  JPEGOptions.formatOptions = FormatOptions.OPTIMIZEDBASELINE;
  JPEGOptions.matte = MatteType.BLACK;
  JPEGOptions.quality = 100;
  doc.exportDocument(myFile, ExportType.SAVEFORWEB, JPEGOptions);
}
function createGrailedServantsArray() {
    var grailed = app.activeDocument.layerSets[0].artLayers.getByName("Grailed IDs").textItem.contents;
    var grailedArray = grailed.split(/[,.\s]/);
    var grailedProvisoryLength = grailedArray.length;
    for (var i = 0; i < grailedProvisoryLength; i++) {
        if (grailedArray[i] == '') {
            grailedArray.splice(i, 1);
        }
    }
    return grailedArray;
}
function verifyGrailedServant(id) {
    var grailedServantsLength = grailedServants.length;
    var flag = false
    for (var i = 0; i < grailedServantsLength; i++) {
        if (id == grailedServants[i]) {
            flag = true;
        }
    }
    return flag;
}
function setAssets(rarity) {
    var index = matchRarity(rarity);
    var svtDefinedStats = svtStats[index];
    rarityColor = svtDefinedStats.color;
    if (verifyGrailedServant(servantID)) {
        servantLevel = 'Level: ' + prompt("Insert Servant Level.");
    }
    else {
        servantLevel = svtDefinedStats.level;
    }
    if (index > 2) {
        npLevel = 'NP' + prompt("Insert NP Level.");
    }
    else {
        npLevel = svtDefinedStats.np;
    }
}
function matchRarity(rarity) {
    var raritiesArray = svtStats[5].rarities;
    var i = 0;
    while(true) {
        if(rarity == raritiesArray[i]) {
            return i;
        }
        else {
            i++;
        }
    }
}